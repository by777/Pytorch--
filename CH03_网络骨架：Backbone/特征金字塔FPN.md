# 多尺度问题

为了增强语义性，传统的特征检测模型只在CNN的最后一个特征图上进行后续操作，而这一层对应的下采样率（缩小的倍数）又通常比较大，如16、32。造成小物体的检测性能较低。

# 图像金字塔（Image Pyramid）

主要思路在于提取多尺度特征，通过将输入图片做成多个尺度，不同尺度的图像对应生成不同尺度的特征。这样做简单高效，也耗时。

# FPN（Feature Pyramid Network）

主要包含：自下而上网络、自上而下网络、横向连接与卷积融合4个部分。

![image-20210712095225996](https://raw.githubusercontent.com/by777/imgRep/main/img/20210712095226.png)

+ **自下而上**：最左侧代表普通的卷积网络，默认使用ResNet结构，用作提取语义信息。C1代表了ResNet的前几个卷积层与池化层，而C2~C5分别为不同的ResNet卷积组，这些卷积组包含了多个Bottleneck结构，组内特征图大小相同，组件大小递减。

+ **自上而下**：首先对C5进行1x1卷积降低通道数得到P5，然后依次进行**上采样**得到P4、P3和P2，目的是得到与C4、C3、C2长宽相同的特征。以方便下一步的逐元素相加。这里采用2倍最邻近上采样，即直接对临近元素进行复制，而非线性插值。

+ **横向连接（Lateral Connection）**:目的是将**上采样后的高语义特征与浅层的定位细节特征**进行融合。高语义特征经过上采样后，其长宽与对应的浅层特征相同，其通道数固定为256，因此需要对底层特征C2~C4进行1x1卷积使得通道数变为256，然后两者进行逐元素相加得到P4、P3、P2。由于C1特征图尺寸较大且语义信息不足，因此没有把C1放到横向连接中。

+ **卷积融合**：在得到相加的特征后，利用3x3卷积再对生成的P2至P4再进行融合。目的是消除上采样过程中带来的重叠效应，以此生成最终的特征图。

  > 自下而上指的是金字塔从下到上

# RoI（Region of Interests）

对于实际的目标检测算法，需要对特征图上进行RoI提取。而FPN有4个输出的特征图，选择哪一个特征图上的特征也是个问题。FPN给出的解决方法是。对于不同大小的RoI，使用不同的特征图，大尺度的RoI再深层的特征图上进行提取，如P5，小尺度的RoI在浅层的特征图上提取，如P2。